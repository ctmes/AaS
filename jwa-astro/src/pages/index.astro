---
import { getEntry, getCollection } from 'astro:content';
import HomeHero from '../components/HomeHero.astro';
import ApplicationGrid from '../components/ApplicationGrid.astro';
import ContentBlock from '../components/ContentBlock.astro';

const homepageEntry = await getEntry('globals', 'homepage');
const homepage = homepageEntry ? homepageEntry.data : null;

const applicationsEntries = await getCollection('applications');
const applications = applicationsEntries.map(entry => entry.data);

const heroData = homepage ? {
    title: homepage.hero_title,
    video: homepage.hero_video,
    image: homepage.hero_image,
} : {};

const introData = homepage ? {
    heading: homepage.intro_heading,
    content: homepage.intro_text,
} : {};

const specialistsData = homepage ? {
    heading: homepage.specialists_heading,
    content: homepage.specialists_content,
    ctaText: homepage.specialists_cta_text,
    ctaUrl: homepage.specialists_cta_url,
} : {};
---

<html lang="en">
	<head>
		<meta charset="utf-8" />
		<link rel="icon" type="image/svg+xml" href="/favicon.svg" />
		<meta name="viewport" content="width=device-width" />
		<title>{homepage ? homepage.title : 'JWA Mats'}</title>
        <!-- Import any global styles or fonts here -->
        <style>
             @import url('https://fonts.googleapis.com/css2?family=Nunito+Sans:wght@400;600;700&display=swap');
             body { font-family: 'Nunito Sans', sans-serif; margin: 0; }
        </style>
	</head>
	<body>
        {homepage ? (
            <>
                <HomeHero {...heroData} />
                <ContentBlock {...introData} /> 
                <ApplicationGrid applications={applications} />
                <ContentBlock {...specialistsData} />
            </>
        ) : (
             <div style="padding: 50px; text-align: center;">
                <h1>Backend Connection Error</h1>
                <p>Could not load homepage data from Statamic.</p>
            </div>
        )}
	</body>
</html>
