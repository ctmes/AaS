---
import { getEntry, getCollection } from 'astro:content';
import HomeHero from '../components/HomeHero.astro';
import ApplicationGrid from '../components/ApplicationGrid.astro';
import ContentBlock from '../components/ContentBlock.astro';
import Awards from '../components/Awards.astro';
import CaseStudies from '../components/CaseStudies.astro';
import ClientSlider from '../components/ClientSlider.astro';
import Layout from '../layouts/Layout.astro';

const homepageEntry = await getEntry('globals', 'homepage');
const homepage = homepageEntry ? homepageEntry.data : null;

const applicationsEntries = await getCollection('applications');
const applications = applicationsEntries.map(entry => entry.data);

const heroData = homepage ? {
    title: homepage.hero_title,
    video: homepage.hero_video,
    image: homepage.hero_image,
} : {};

const introData = homepage ? {
    heading: homepage.intro_heading,
    content: homepage.intro_text,
} : {};

const specialistsData = homepage ? {
    heading: homepage.specialists_heading,
    content: homepage.specialists_content,
    ctaText: homepage.specialists_cta_text,
    ctaUrl: homepage.specialists_cta_url,
} : {};
---

<Layout title={homepage ? homepage.title : 'JWA Mats'}>
    {homepage ? (
        <>
            <HomeHero {...heroData} />
            <ContentBlock {...introData} /> 
            <ApplicationGrid applications={applications} />
            <ContentBlock {...specialistsData}>
                <Awards />
            </ContentBlock>
            <CaseStudies />
            <ClientSlider />
        </>
    ) : (
            <div style="padding: 50px; text-align: center;">
            <h1>Backend Connection Error</h1>
            <p>Could not load homepage data from Statamic.</p>
        </div>
    )}
</Layout>
